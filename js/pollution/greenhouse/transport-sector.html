<html>

<head>
	<style>
		table,
		thead,
		tr,
		th,
		tbody,
		td,
		tfoot {
			border: 1px black solid;
		}

		th,
		td {
			text-align: left;
		}

		th.num,
		td.num {
			text-align: right
		}
	</style>
	<title>%frontend_asset_name%</title>

</head>

<body>

	<div id=app>
		<regioninfo v-for="table in tables" :table=table></regioninfo>
		<pre>{{ $data }}</pre>
	</div>


	<template id=region-template>
		<div :id="'region_' + table.index" class="region-info region-queensland">
			<h4 v-text="table.heading"></h4>
			<ul class=chart-tabs :data-index=table.index v-if=table.hasChart>
				<li class=active><span>Chart</span>
				<li><span>Table</span>
			</ul>
			<div class=chart-table>
				<div :id="'chart_' + table.index" class=chart v-if=table.hasChart></div>
				<div :id="'table_' + table.index" class="responsive-table sticky inactive">
					<table class="indicators zebra">
						<thead>
							<tr>
								<th v-for="(th, i) in table.rows[0]" scope=col :class="{num: i > 0}" v-text=th>
						<tbody>
							<tr v-for="tr in table.rows.slice(1)">
								<th scope=row v-text=tr[0]>
								<td v-for="td in tr.slice(1)" class=num v-text=td.toFixed(3)>

					</table>
				</div>
			</div>
		</div>

		</div>
	</template>


	<script src=/js/server-render.js> </script>
	<script src="https://www.gstatic.com/charts/loader.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

	<script>
		Vue.component("regioninfo", {
			props: ["table"],
			template: "#region-template"
		});


		google.charts.load("current", { packages: ["corechart"] });
		google.charts.setOnLoadCallback(function () {


			var results = Papa.parse(
				document.getElementById("csvdata").textContent,
				{
					skipEmptyLines: true,
					dynamicTyping: true,
				}
			);
			var headRow = results.data.shift().map(function (th) { return th.toString(); });
			var totalRow = results.data.pop();

			console.log("data from papaparse", results);

			var index = 0;

			///////////////////////////////////////////////////

			var tableData = results.data.map(function (record) {
				return [record[0], record[record.length - 1]];
			});

			var head = ["Category", "Emissions (million tonnes)"];
			tableData.unshift(head);

			var tables = [{
				rows: tableData,
				type: "pie",
				options: getDefaultPieChartOptions(),
				heading: "Proportion of Queensland’s transport emissions by category, " + headRow[headRow.length - 1],
				hasChart: true,
				index: index++
			}];


			//////////////////////////////////////////////////////////////////////////////////////

			chart = results.data;
			chart.unshift(headRow);

			var options = getDefaultAreaChartOptions();
			options.vAxis.title = "Tonnes (millions)";


			tables.push({
				rows: chart,
				heading: "Trends in Queensland's transport emissions, by category",
				hasChart: true,
				index: index++,
				type: "area",
				options: options,
				transpose: true
			});


			//////////////////////////////////////////////
			data = totalRow.slice(1).map(function (row, i) {
				return [headRow[i + 1], row];
			});
			data.unshift(["Year", "Emissions (million tonnes)"]);

			tables.push(
				{
					rows: data,
					heading: "Queensland’s total transport emissions",
					hasChart: false,
					index: index++
				});

			////////////////////////////////////////////////////////////////////////////////////////

			var vm = new Vue({
				el: "#app",
				data: { tables: tables } // data: {tables: tables } // reäctive
			});
			//vm.tables = tables;// non-reäctive


			///////////////////////////////////////////////////////////////////////////////


			soejs = {
				chartsLoaded3: function () {
					console.log("chart drawn");
				}
			};


			var charts = tables.filter(function (t) { return t.hasChart });

			soejs.num_charts = tables.length;
			charts.forEach(function (chart, i) {

				var rows = chart.rows;
				if (chart.transpose)
					rows = rows.transpose();

					

				var data = google.visualization.arrayToDataTable(rows);


				switch (chart.type) {
					case "pie":
						var chart = new google.visualization.PieChart(document.getElementById("chart_" + chart.index));
						break;
					case "line":
						var chart = new google.visualization.LineChart(document.getElementById("chart_" + chart.index));
						break;
					case "column":
						var chart = new google.visualization.ColumnChart(document.getElementById("chart_" + chart.index));
						break;
					case "bar":
						var chart = new google.visualization.BarChart(document.getElementById("chart_" + chart.index));
						break;
					case "area":
						var chart = new google.visualization.AreaChart(document.getElementById("chart_" + chart.index));
						break;
				}


				google.visualization.events.addListener(chart, "ready", soejs.chartsLoaded3);
				chart.draw(data, chart.options);


			});




		});


	</script>
	<script id=csvdata type=application/json>Category,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016
Domestic aviation,0.636,0.79,0.79,0.898,0.953,1.125,1.238,1.319,1.198,1.158,1.206,1.332,1.257,1.211,1.282,1.437,1.526,1.664,1.78,1.815,1.801,1.948,2.22,2.287,2.376,2.196,2.342
Cars,5.947,6.020,6.228,6.498,6.688,6.978,7.127,7.146,7.244,7.534,7.720,7.671,7.840,8.278,8.650,8.813,8.927,8.837,9.086,9.059,9.104,9.114,9.450,9.384,9.144,9.532,10.123
Light commercial vehicles,1.293,1.296,1.343,1.408,1.461,1.541,1.598,1.631,1.674,1.662,1.756,1.928,2.060,2.067,2.331,2.279,2.344,2.525,2.680,2.800,2.949,2.971,3.048,3.091,3.106,3.160,3.555
Heavy duty trucks and buses,2.182,2.174,2.257,2.397,2.532,2.740,2.923,3.082,3.224,3.213,3.301,3.205,3.416,3.535,3.687,3.800,4.030,4.321,4.363,4.394,4.397,4.673,5.000,5.109,5.324,5.350,5.361
Motorcycles,0.035,0.036,0.037,0.038,0.039,0.04,0.041,0.041,0.041,0.03,0.034,0.039,0.05,0.04,0.047,0.04,0.041,0.061,0.067,0.07,0.074,0.065,0.058,0.061,0.057,0.065,0.069
Railways,0.379,0.38,0.284,0.277,0.284,0.287,0.282,0.279,0.277,0.292,0.291,0.365,0.429,0.426,0.527,0.474,0.458,0.459,0.8,0.8,0.79,0.755,0.788,0.827,0.818,0.663,0.63
Navigation,0.661,0.694,0.657,0.638,0.602,0.753,0.684,0.732,0.761,0.607,0.634,0.674,0.677,0.676,0.766,0.971,0.862,1.031,0.385,0.745,0.725,0.616,0.537,0.334,0.34,0.36,0.362
Other,0.053,0.053,0.059,0.059,0.045,0.039,0.039,0.039,0.039,0.039,0.06,0.06,0.06,0.065,0.069,0.071,0.076,0.078,0.083,0.053,0.064,0.102,0.11,0.125,0.108,0.097,0.073
Total,11.186,11.443,11.719,12.213,12.603,13.504,13.931,14.27,14.458,14.535,15.003,15.273,15.789,16.298,17.359,17.885,18.263,18.976,19.245,19.736,19.903,20.38,21.219,21.226,21.24,21.423,22.514
</script>

</body>

</html>